# Übungen zu Cron, at und systemd Timer

## Cron

### Übung 1: Cron Grundlagen  
Schau dir den Inhalt der Datei `/etc/crontab` an. Notiere die Struktur (Felder) und erkläre kurz, welche Bedeutung jedes Feld hat.  

**Lösung:** Die Struktur lautet `MINUTE HOUR DAY_OF_MONTH MONTH DAY_OF_WEEK USER COMMAND`. Jede Zeile legt fest, wann und von wem ein Befehl ausgeführt wird.

### Übung 2: Konkreter Cron-Job 1
Erstelle einen Cron-Job, der jeden Montag, Dienstag und Mittwoch um 14:30 Uhr die Datei `/tmp/cron_test.txt` mit dem Inhalt `Cron was here: <Datum>` anlegt. `<Datum>` soll natürlich das dann jeweils aktuelle Datum sein.  

### Übung 3: Konkreter Cron-Job 2
Erstelle einen Cron-Job, der alle zwei Minuten die Datei `/tmp/cron_test.txt` mit dem Inhalt `Cron was here: <Datum>` anlegt.

### Übung 4: Skript stündlich ausführen lassen 
Erstelle ein Skript `somehourlyjob`, welches die Zeile `Hourly was here: <Datum>` in die Datei `/var/log/somehourlyjob.log` schreibt. Das Skript soll stündlich ausgeführt werden. Nutze dafür **nicht** die Datei `/etc/crontab` oder die Crontab eines Users sondern einen anderen Weg (mit `cron`).

Erstelle eine Datei `/etc/cron.hourly/somehourlyjob` mit einem Skript, das jede Stunde eine Logzeile in `/var/log/somehourlyjob.log` schreibt.  

### Übung 5: Cron-Job löschen
4. Mit welchem Kommando kann man die gesamte Crontab eines Users löschen? Wie lässt sich das anschliessend überprüfen?

### Übung 6: Zugriff auf Cron konfigurieren  
Erkläre bzw. mache dir bewusst, welche Wirkung `/etc/cron.allow` und `/etc/cron.deny` haben.  

### Übung 7: Benutzer die Nutzung von `cron` erlauben 
- Lege fest, dass nur der Benutzer `karla` Cron nutzen darf.  
- Teste, ob `karla` `crontab -e` ausführen kann (falls dieser User nicht existiert, erstelle ihn)
- Teste, ob ein anderer User `crontab -e` ausführen kann
- Entferne die Konfiguration anschliessend wieder.  

---

## at / batch Jobs  

### Übung 8: at.allow und at.deny
1. Prüfe, ob `/etc/at.allow` und `/etc/at.deny` existieren. Falls nicht, installiere `at` mit `apt install at` und prüfe erneut. Schau dir den Inhalt an und erkläre den Sinn.
2. Wer darf `at` nutzen, wenn keine der beiden Dateien existiert?

### Übung 9: Einmalige Jobs mit at ausführen/planen
1. Plane einen einmaligen `at`-Job. In 3 Minuten soll die Datei `/tmp/at_test.txt` erstellt werden mit dem Inhalt: `at was here: <datum>`.
2. Überprüfe die geplanten Jobs mit `atq`.
3. Erstelle zwei weitere Job analog zu Teilaufgabe 1, einer soll in 5 Minuten, der andere am nächsten Tag um 4 Uhr nachmittags ausgeführt werden. Überprüfe die ausstehenden Jobs diesmal mit einem anderen Kommando als `atq`. Wirf sowohl für die Kommandos als auch für die Zeitangaben einen Blick in die Manpage von `at`. Entferne die Jobs nacheinander mit zwei unterschiedlichen Kommandos.
3. Konfiguriere, dass nur `karla` `at` nutzen darf. Teste die Konfiguration mit einem anderen User.

---

## systemd Timer Units  

### Übung 10: Periodischen Job mit sytemd-timer erstellen
1. Sorge mit einem Systemd Timer dafür, dass alle 2 Minuten die Meldung `Timer was here: <datum>` an die Datei `/var/log/mytimer.log` angehängt wird. Denk daran, dass du einmal den eigentlichen Timer mit der Endung `.timer` und den dazugehörigen Service mit der Endung `.service` unter `/etc/systemd/system/` erstellen musst. War das alles? Oder fehlt da noch eine Kleinigkeit...? Nutze die Manpages `systemd.timer` und `sytemd-run`.
2. Halte den Timer nach ein paar Durchgängen an bzw. sorge dafür, dass er nicht mehr ausgehführt wird. Starte ihn anschliessend wieder.

### Übung 11: Einmaligen Job mit sytemd-run planen/erstellen
Nutze `systemd-run` um in 30s die Meldung `systemd-run was here: <datum>` in die Datei `/var/log/systemd-run.log` zu schreiben.

### Übung 12: batch Kommando

Erkläre, wozu das `batch` Kommando genutzt werden könnte und erstelle einen `batch`-Job analog zu den anderen Aufgaben. Mit welchem Kommando kannst du überprüfen, ob es ausstehende `batch`-Jobs gibt?

## Liste mit für die Übungen relevanten Dateien und Verzeichnissen:

`/etc/cron.{d,daily,hourly,monthly,weekly}/`, `/etc/at.deny`, `/etc/at.allow`, `/etc/crontab`, `/etc/cron.allow`, `/etc/cron.deny`, `/var/spool/cron/`, `crontab`, `at`, `atq`, `atrm`, `systemctl`, `systemd-run`, `/var/log/cron`
